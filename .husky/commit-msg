echo "🔍 Validating commit message format..."
npx commitlint --edit $1

branch_name=$(git symbolic-ref --short HEAD)
echo "🌿 Current branch: $branch_name"

valid_pattern="^(feat|fix|hotfix|release|chore|docs|test|refactor)\/[a-z0-9-]+$|^(master|main|develop|staging)$"

if ! echo "$branch_name" | grep -qE "$valid_pattern"; then
  echo "❌ Invalid branch name: $branch_name"
  echo "📋 Branch name must follow the pattern:"
  echo "   - feat/feature-name"
  echo "   - fix/bug-description"
  echo "   - hotfix/critical-fix"
  echo "   - release/version-number"
  echo "   - chore/task-description"
  echo "   - docs/documentation-update"
  echo "   - test/test-description"
  echo "   - refactor/refactor-description"
  echo "   - Or be one of: master, main, develop, staging"
  exit 1
fi

echo "✅ Commit message and branch name validation passed!"